From 41ed6af1a4ba663b55d70a723af3fdf1ab69eca1 Mon Sep 17 00:00:00 2001
From: Thomas Perl <thomas.perl@jolla.com>
Date: Mon, 11 Nov 2013 12:50:05 +0100
Subject: [PATCH 08/40] scan-desktop-files: Don't scan manually installed files

---
 src/plugins/pk-plugin-scan-desktop-files.c | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/src/plugins/pk-plugin-scan-desktop-files.c b/src/plugins/pk-plugin-scan-desktop-files.c
index c84f5a3ae..df03a71b9 100644
--- a/src/plugins/pk-plugin-scan-desktop-files.c
+++ b/src/plugins/pk-plugin-scan-desktop-files.c
@@ -289,6 +289,12 @@ pk_plugin_sqlite_add_filename (PkPlugin *plugin,
 	else
 		md5 = pk_plugin_get_filename_md5 (filename);
 
+	// Sailfish OS: Avoid scanning of manually installed .desktop files
+	if (strstr(filename, PK_DESKTOP_DEFAULT_APPLICATION_DIR "/apkd_launcher_") == filename) {
+		g_warning ("Skipping custom .desktop file: %s", filename);
+		goto out;
+	}
+
 	/* resolve */
 	package = pk_plugin_get_installed_package_for_file (plugin,
 							    filename,
-- 
2.13.6

